<%- include header.html %>

<script src="/js/absolute.js"></script>
<style>
body {
	background: #eee;
}
</style>

<div class='uk-container'>
	<ul class='title'>
		<li>
			<a href="#drawer" class="uk-icon-button uk-icon-navicon"
			   id='navicon' data-uk-offcanvas></a>
		</li>
		<li>
			<a href="/" class="uk-icon-button uk-icon-home"></a>
		</li>
		<li>
			<a href="" class="uk-icon-button uk-icon-refresh"
				onclick='javascript:restart();'></a>
		</li>

		<% if (user === document.user) { %>
		<li>
			<a href="" class="uk-icon-button uk-icon-plus"
				onclick='javascript:createChart({})'></a>
		</li>

		<li>
			<a href="" class="uk-icon-button uk-icon-save"
				onclick='javascript:documentSaveLayout()'></a>
		</li>
		<li>
			<a href="#settings" class="uk-icon-button uk-icon-gears"
				data-uk-modal></a>
		</li>
		<% } %>

		<!-- <li style='width:2rem;'></li> -->
		<li style=''>
			<h2 style='margin:0; text-shadow: 0 1px white;'>
				<%= document.name %>
			</h2>
		</li>
	</ul>
</div>

<script>

var doc_s = '<%= document.id %>';
var doc = doc_s === '' ? 0 : parseInt(doc_s);
var charts = new Array();
var data;
var xf;
var dimension;
var group;
var keys;

function main() {
	$('.chart').remove();
	while (charts.length > 0) {
		charts.pop();
	}

	// TODO: load charts from ajax not the backend code
	<% for (var i = 0; i < charts.length; i++) { %>
		createChart({
			id:		<%= charts[i].id %>,
			name:		'<%= charts[i].name %>',
			type:		'<%= charts[i].type %>',
			dimension:	'<%= charts[i].dimension %>',
			group:		'<%= charts[i].reduce %>',
			sort:		'<%= charts[i].sort %>',
			top:		'<%= charts[i].top %>',
			top_value:	'<%= charts[i].top_value %>',
			x:		<%= charts[i].x %>,
			y:		<%= charts[i].y %>,
			width:	<%= charts[i].width %>,
			height:	<%= charts[i].height %>
		});
	<% } %>

	restart();
}

function restart() {
	createCrossFilter("/data/<%= document.id %>");
}

$(document).ready(function() {
	main();
});

</script>

<script type="text/html" id="chart-template">
<div class='chart' id='chart_id'>
	<span class='handle'>
		<span class='title'></span>
		<span class='button'>
		<i class="uk-icon-gears" onclick='javascript:chartSettings(_id)'></i>
		<i class="uk-icon-trash-o" onclick='javascript:chartDelete(_id)'></i>
		</span>
	</span>
</div>
</script>

<div id="chart-settings" class="uk-modal" data-chart-id="0">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<h1>Settings</h1>
		<form class="uk-form" action="javascript:chartSettingsSave()">
			<input type="hidden" name="id" value="0" />
			<div class="uk-grid uk-grid-preserve">

				<div class="uk-width-1-3">
					Name
				</div>
				<div class="uk-width-2-3">
					<input class="uk-width-1-1" type="text" name="name"
						   autofocus />
				</div>

				<div class="uk-width-1-3">
					Chart Type
				</div>
				<div class="uk-width-2-3">
					<select class="uk-width-1-1" name="type">
						<option value="none">None</option>
						<option value="pie">Pie</option>
						<option value="row">Row</option>
						<option value="bar">Bar</option>
						<option value="line">Line</option>
					</select>
				</div>

				<div class="uk-width-1-3">
					Dimension
				</div>
				<div class="uk-width-2-3">
					<input class="uk-width-1-1" type="text" name="dimension" />
				</div>

				<div class="uk-width-1-3">
					Group
				</div>
				<div class="uk-width-2-3">
					<input class="uk-width-1-1" type="text" name="group" />
				</div>

<!--
				<div class="uk-width-1-3">
					Sort
				</div>
				<div class="uk-width-2-3">
					<select class="uk-width-1-1" name="sort">
						<option value="none">None</option>
						<option value="asc">Ascending A-Z</option>
						<option value="desc">Descending Z-A</option>
					</select>
				</div>
-->

				<div class="uk-width-1-3">
					<select class="uk-width-1-1" name="top">
						<option value="top">Top</option>
						<option value="bottom">Bottom</option>
					</select>
				</div>
				<div class="uk-width-2-3">
					<input class="uk-width-1-1" type="text" name="top-value" />
				</div>

				<div class="uk-width-1-3"></div>
				<div class="uk-width-2-3">
					<input type="submit" value="Save"
					   class="uk-button uk-button-primary" />
				</div>
			</div>

		</form>
	</div>
</div>

<div id="settings" class="uk-modal">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<h1>Settings</h1>

		<form class='uk-form' action='javascript:documentSettingsSave()'>
			<div class='uk-grid uk-grid-preserve'>
				<div class='uk-width-3-10'>
					<label>Name</label>
				</div>
				<div class='uk-width-7-10'>
					<input type='text' name='name' class='uk-width-1-1'
					   value='<%= document.name %>' />
				</div>

				<div class='uk-width-3-10'>
					<label>Public</label>
				</div>
				<div class='uk-width-7-10'>
					<input type='checkbox' name='public'
						<%= document.public ? 'checked' : '' %> />
				</div>

				<div class='uk-width-1-1'>&nbsp;</div>

				<div class='uk-width-1-1'>
					<input type='submit' value='Save'
					   class='uk-button uk-button-primary' />
					<!--
					<input type='button' value='Cancel'
					   class='uk-button'
					   onclick='javascript:documentSettingsClose()' />
					<input type='hidden' />
					-->
				</div>
			</div>
		</form>
	</div>
</div>

<%- include drawer.html %>
<%- include footer.html %>
