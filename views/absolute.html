<%- include header.html %>
<div>
	<ul class='title'>
		<li>
			<a href="#drawer" id='navicon' data-uk-offcanvas
				class="uk-icon-button uk-icon-bars"></a>
		</li>
		<li>
			<a href="/" class="uk-icon-button uk-icon-home"></a>
		</li>
		<li>
			<a href="javascript:location.reload()"
				class="uk-icon-button uk-icon-refresh"></a>
		</li>
		<% if (user !== 0) { %>
		<li>
			<a href='javascript:createChart({})'
				class="uk-icon-button uk-icon-plus"></a>
		</li>
		<li>
			<a href='javascript:documentSaveLayout()'
				class="uk-icon-button uk-icon-save"></a>
		</li>
		<li>
			<a href="#settings" data-uk-modal
				class="uk-icon-button uk-icon-gears"></a>
		</li>
		<% } %>
		<li>
			<!-- <h2 style='margin:0; text-shadow: 0 1px white;'> -->
			<%= document.name %>
		</li>
	</ul>
</div>

<div id='ruler'>
	<span class='item' style='left:320px;'  >320</span>
	<span class='item' style='left:480px;'  >480</span>
	<span class='item' style='left:640px;'  >640</span>
	<span class='item' style='left:768px;'  >768</span>
	<span class='item' style='left:1024px;'>1024</span>
	<span class='item' style='left:1280px;'>1280</span>
	<span class='item' style='left:1600px;'>1600</span>
	<span class='item' style='left:1920px;'>1920</span>
</div>

<script type="text/html" id="chart-template">
<div class='chart' id='chart_id'>
	<span class='handle'>
		<span class='title'></span>
		<span class='button'>
			<i class="uk-icon-gears" onclick='javascript:chartSettings(_id)'></i>
		</span>
	</span>
</div>
</script>

<div id="chart-settings" class="uk-modal" data-chart-id="0">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<h1>Settings</h1>
		<form class="uk-form" action="javascript:chartSettingsSave()">
			<input type="hidden" name="id" value="0" />
			<div class="uk-grid uk-grid-preserve">

				<div class="uk-width-1-3">
					Name
				</div>
				<div class="uk-width-2-3">
					<input class="uk-width-1-1" type="text" name="name"
						   autofocus />
				</div>

				<div class="uk-width-1-3">
					Chart Type
				</div>
				<div class="uk-width-2-3">
					<select class="uk-width-1-1" name="type">
						<option value="none">None</option>
						<option value="pie">Pie</option>
						<option value="row">Row</option>
						<option value="bar">Bar</option>
						<option value="line">Line</option>
						<option value="wordcloud">Word Cloud</option>
					</select>
				</div>

				<div class="uk-width-1-3">
					Dimension
				</div>
				<div class="uk-width-2-3">
					<!--
					<input class="uk-width-1-1" type="text" name="dimension" />
					-->
					<select class='uk-width-1-1' name='dimension'></select>
				</div>

				<div class="uk-width-1-3">
					Group
				</div>
				<div class="uk-width-2-3">
					<!--
					<input class="uk-width-1-1" type="text" name="group" />
					-->
					<select class='uk-width-1-1' name='group'></select>
				</div>

				<div class="uk-width-1-3">
					Sort
				</div>
				<div class="uk-width-2-3">
					<select class="uk-width-1-1" name="sort"
						onchange='sortChange()'>
						<option value="none">None</option>
						<option value="asc">Ascending A-Z</option>
						<option value="desc">Descending Z-A</option>
					</select>
				</div>

				<div class="uk-width-1-3">
					Filter
				</div>
				<div class="uk-width-2-3">
					<select class="uk-width-4-10" name="top"
						onchange='topChange()'>
						<option value="none">None</option>
						<option value="top">Top</option>
						<option value="bottom">Bottom</option>
					</select>
					<input class="uk-width-5-10" type="text" name="top-value"
						style='display:none; '/>
					<input type='hidden' />
				</div>

				<div class="uk-width-1-3"></div>
				<div class="uk-width-2-3">
					<input type="submit" value="Save"
						class="uk-button uk-button-primary" />
					<input type="button" value="Delete"
						onclick="javascript:chartDeleteThis()"
						class="uk-button uk-button-danger" />
					<input type="hidden" />
				</div>
			</div>
		</form>
	</div>
</div>

<div id="settings" class="uk-modal">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<h1>Settings</h1>

		<form class='uk-form' method='post' action='/document-save'
			enctype="multipart/form-data" >
			<input type='hidden' name='document' value='<%= document.id %>' />
			<input type='file' name='file'
				style='display:none; width:4px; height:4px;' />

			<div class='uk-grid uk-grid-preserve'>
				<div class='uk-width-3-10'>
					<label>Name</label>
				</div>
				<div class='uk-width-7-10'>
					<input type='text' name='name' class='uk-width-1-1'
					   value='<%= document.name %>' />
				</div>

				<div class='uk-width-3-10'>
					<label>Upload Data</label>
				</div>
				<div class='uk-width-7-10'>
					<input type='button' class='uk-button' value='Choose File'
						onclick='javascript:documentChooseFile()' />
				</div>

				<div class='uk-width-3-10'>
					<label>Public</label>
				</div>
				<div class='uk-width-7-10'>
					<input type='checkbox' name='public'
						checked /> Allow everyone view this document.
				</div>

				<div class='uk-width-3-10'> &nbsp;
				</div>

				<div class='uk-width-7-10'>
					<input type='submit' value='Save'
					   class='uk-button uk-button-primary' />

					<!--
					<input type='button' value='Cancel'
					   class='uk-button'
					   onclick='javascript:documentSettingsClose()' />
					<input type='hidden' />
					-->
				</div>
			</div>
		</form>
	</div>
</div>

<script src="/js/absolute.js"></script>

<script>
"use strict;"

var doc_s = '<%= document.id %>';
var doc = doc_s === '' ? 0 : parseInt(doc_s);
var charts = new Array();
var data;
var xf;
var dimension;
var group;
var columns;

function main() {
	$('.chart').remove();
	while (charts.length > 0) {
		charts.pop();
	}

	// TODO: load charts from ajax not the backend code
	<% for (var i = 0; i < charts.length; i++) { %>
		createChart({
			id:		<%= charts[i].id %>,
			name:		'<%= charts[i].name %>',
			type:		'<%= charts[i].type %>',
			dimension:	'<%= charts[i].dimension %>',
			group:		'<%= charts[i].reduce %>',
			sort:		'<%= charts[i].sort %>',
			top:		'<%= charts[i].top %>',
			top_value:	'<%= charts[i].top_value %>',
			x:		<%= charts[i].x %>,
			y:		<%= charts[i].y %>,
			width:	<%= charts[i].width %>,
			height:	<%= charts[i].height %>
		});
	<% } %>

	restart();
}

function restart() {
	createCrossFilter("/data/<%= document.id %>");
}

$(document).ready(function() {
	$('body').on('mouseup', function() {
		snapAll();
		$('#ruler').fadeOut();
	});
	main();
});

</script>

<%- include drawer.html %>
<%- include footer.html %>
