<%- include header.html %>

<div>
	<ul class='title'>
		<li>
			<a href="#drawer" id='navicon' data-uk-offcanvas
				class="uk-icon-button uk-icon-bars"></a>
		</li>
		<li>
			<a href="javascript:showIndex()"
				class="uk-icon-button uk-icon-home"></a>
		</li>
		<li>
			<%= title %>
		</li>
		<li>
			<a href='#new-document' id='new' style='display:none;'
				class="uk-icon-button uk-icon-file-o" data-uk-modal></a>
		</li>
		<li>
			<a href="javascript:logout()" id='logout' style='display:none;'
				class="uk-icon-button uk-icon-sign-out"></a>
		</li>
	</ul>
</div>

<div class='uk-container' id='main'>

</div>

<div class="uk-modal" id="modal">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<div class="content">
		</div>
	</div>
</div>

<script>
"use strict;"
$(document).ready(main);
var session = null;

function main() {
	$.getJSON('/session')
	.success(function(result) {
		session = result;
		if (result == null) {
			showWelcome();
		}
		else {
			showIndex();
		}
		updateToolbar();
	})
	.error(function(result) {
		showWelcome();
	});
}

function updateToolbar() {
	if (session == null) {
		$('#logout').fadeOut();
		$('#new').fadeOut();
	}
	else {
		$('#logout').fadeIn();
		$('#new').fadeIn();
	}
}

function showIndex() {
	if (session == null) {
		showWelcome();
	}
	else {
		$.getJSON('/document-list')
		.success(function(result) {
			if (result.result === 'ok') {
				var html = "<ul class='no-header'>";
				for (var i = 0; i < result.data.length; i++) {
					html += "<li><a href='/document/" +
						result.data[i].id + "'>" +
						result.data[i].name + "</a></li>";
				}
				html += "</ul>";
				$('#main').html(html);
				updateToolbar();
			}
		});
	}
}

function showWelcome() {
	$.get('/welcome.html')
	.success(function(result) {
		$('#main').html(result);
		updateToolbar();
	});
}

function showLogin() {
	if (session == null) {
		$.get('/login.html')
		.success(function(result) {
			$('#main').html(result);
			$('[name=username]').focus();
		});
	}
	else {
		showIndex();
	}
}

function login() {
	var username = $('[name=username]').val();
	var password = $('[name=password]').val();
	$.post('/login', {username: username, password: password})
	.success(function(result) {
		if (result.result === 'ok') {
			main();
		}
	});
}

function logout() {
	$.get('/logout')
	.success(function() {
		session = null;
		showWelcome();
	})
}

</script>


<div id="new-document" class="uk-modal">
	<div class="uk-modal-dialog">
		<a class="uk-modal-close uk-close"></a>
		<h2>New</h2>

		<form method="post" action="/document-create"
			enctype="multipart/form-data" class="uk-form" >

			<input type="text" name="name" placeholder="Title" autofocus
					class="uk-width-1-1" />

			<h3>Theme</h3>
			<div data-uk-button-radio>
				<a href="javascript:theme('Light')" class="uk-button">
					Light
				</a>

				<a href="javascript:theme('Dark')" class="uk-button">
					Dark
				</a>

			</div>

			<h3>Data Upload</h3>
			<a href="javascript:chooseFile()" class="uk-button">
				Choose File
			</a>

			<input type="hidden" name="theme" value='Light' />
			<input type="file" name="file"  style="display:none;" />

			<hr/>
			<input type="submit" value="Create"
				   class="uk-button uk-button-primary" />
		</form>

	</div>
</div>

<script>
function chooseFile() {
	$('[name=file]').click();
}

function theme(t) {
	$('[name=theme]').val(t);
}
</script>



<%- include drawer.html %>
<%- include footer.html %>
