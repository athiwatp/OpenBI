<%- include header.html %>

<script>
	function Controller($scope, $http) {

		$http.get("/data-list")
		.success(function(result) {
			$scope.data = result[0];
			$scope.all = result;
		});

		$scope.new = function() {
			var item = new Object();
			$scope.data = item;
			$scope.all.push(item);
			$('[placeholder=Name]').focus();
		};

		$scope.save = function() {
			console.log($scope.data);
			if ($scope.data.id == null) {
				$scope.data.id = 0;
			}

			$http.post('/data-add', $scope.data).
			success(function(result) {
				console.log(result);
			});
		};

		$scope.show = function(id) {
			for (var i = 0; i < $scope.all.length; i++) {
				if ($scope.all[i].id === id) {
					$scope.data = $scope.all[i];
					break;
				}
			}
		};
		
		$scope.upload = function() {
			$('[name=file]').click();
		};
	}
	
	function uploaderSubmit() {
		console.log('submitting');
		$('#uploader').submit();
	}
</script>

<div class='uk-container'>
	<ul class='title'>
		<li>
			<a href="#drawer" class="uk-icon-button uk-icon-navicon"
			   id='navicon' data-uk-offcanvas></a>
		</li>
		<li>
			<a href="" class="uk-icon-button uk-icon-refresh"
				onclick='location.reload()'></a>
		</li>
		<li>
			OpenBI
		</li>
		
		<li><a href="/">Home</a></li>
		<li><a href="/data">Data</a></li>
		<li><a href="/welcome">Welcome</a></li>
	</ul>
</div>

<div class="uk-container" ng-controller='Controller'>
	<div class="uk-grid uk-grid-preserve">
		<div class="uk-width-1-3">
			<h3>Current Data</h3>
			<!--
			<input type='button' class='uk-button' value='New'
					ng-click='new()' />
			-->
			<input type='button' class='uk-button' value='Upload'
					ng-click='upload()' />
			
			<ul class='uk-list'>
				<li ng-repeat="d in all">
					<a href='' ng-click='show(d.id)'>{{d.name}}</a>
				</li>
			</ul>
		</div>
		<div class='uk-width-2-3'>
			<form class='uk-form' ng-submit='save()'>
				<input type='hidden' ng-model='data.id' />
				<div class='uk-grid uk-grid-preserve'>
					<div class='uk-width-1-1'>

						<br/>
						<input type='text' ng-model='data.name' placeholder='Name' />
						<textarea ng-model='data.data' rows='8'
							placeholder='CSV or TSV or JSON'></textarea>
						<input type='submit' value='Save' class='uk-button' />
					</div>
				</div>
			</form>
		</div>
	</div>
	
	<form method="post" action="/data-upload" enctype="multipart/form-data" 
		  id="uploader" style="display:none;" >
		<input type="file" name="file" onchange="uploaderSubmit()" />
	</form>
</div>

<%- include drawer.html %>
<%- include footer.html %>
